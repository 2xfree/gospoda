#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char yourCar[100];
char opponentCar[100];
char track[2500];

char *yourCarLines[4];
char *opponentCarLines[4];
char *trackLines[23];

void printTrack(int pos1, int pos2);
void loadCar(char car[100]);
void loadTrack();
void prepareLines();

void lose(int pos);
void win();

int main()
{
    
    loadCar(yourCar);
    loadCar(opponentCar);
    loadTrack();
    prepareLines();
    char progress[232] = {0};
    for (int i = 0;i<3;i++){
        printTrack(strlen(progress)/5,i*23);
	fflush(stdout);
        fgets(progress+strlen(progress),101,stdin);
    }

    lose(strlen(progress)/5);

    return 0;
}

void loadCar(char car[100])
{
    FILE *f;
    char *fileName = (car == yourCar) ? "./yourCar.txt" : "./opponentCar.txt";
    f = fopen(fileName, "r");
    fread(car, 100, 1, f);
    fclose(f);
}

void loadTrack()
{
    FILE *f;
    f = fopen("./track.txt", "r");
    fread(track, sizeof track, 1, f);
    fclose(f);
}

void lose(int pos){
    printTrack(pos,78);
    printf("\nYou lose :(\n");
}

void win(){
    FILE *f;
    f = fopen("./flag.txt","r");
    char flag[100];
    fread(flag,100,1,f);
    fclose(f);
    printf("\n%s\n",flag);
    fflush(stdout);
}

void prepareLines()
{
    yourCarLines[0] = strtok(yourCar, "\n");
    for (int i = 1; i < 4; i++)
    {
        yourCarLines[i] = strtok(NULL, "\n");
    }

    opponentCarLines[0] = strtok(opponentCar, "\n");
    for (int i = 1; i < 4; i++)
    {
        opponentCarLines[i] = strtok(NULL, "\n");
    }

    trackLines[0] = strtok(track, "\n");
    for (int i = 1; i < 23; i++)
    {
        trackLines[i] = strtok(NULL, "\n");
    }
}

void printTrack(int pos1,int pos2)
{
    system("clear");
    for (int i = 0; i < 12; i++)
    {
        puts(trackLines[i]);
    }

    for (int i = 0; i < 4; i++)
    {
        printf("%.*s%s%s\n", pos1, trackLines[12 + i], yourCarLines[i], trackLines[12 + i] + pos1 + strlen(yourCarLines[i]));
    }

    for (int i = 16; i < 18;i++){
        puts(trackLines[i]);
    }

    for (int i = 0; i < 4; i++)
    {
        printf("%.*s%s%s\n", pos2, trackLines[18 + i], opponentCarLines[i], trackLines[18 + i] + pos2 + strlen(opponentCarLines[i]));
    }

    for (int i = 22; i < 23;i++){
        puts(trackLines[i]);
    }
}
